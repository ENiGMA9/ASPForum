@using Microsoft.AspNet.Identity;
@model ASPForum.Models.Subject
@{
    ViewBag.Title = "ASPForum";
}

<div class="container category-container">
    <div class="row">
        <div class="col-auto">
            <h2>@Model.Name</h2>
        </div>

    </div>

    @if (User.IsInRole("Administrator") || User.IsInRole("Moderator"))
    {
        <form method="post" action="/Subject/Delete/@Model.Id">
            <button type="submit" class="btn btn-danger m-1">Delete Subject</button>
        </form>
        <br />

        <p class="col-auto align-self-center"> Change parent category:</p>
        foreach (var category in ViewBag.Categories)
        {
            <a class="col-auto align-self-center" href="/Subject/MoveSubject/@Model.Id/@category.Id">@category.Name</a>
            <br />
        }

        <br />
    }

    <hr />

    @if (ViewBag.NewThreadRight)
    {

        <form method="get" action="/Subject/AddThread/@Model.Id">
            <button type="submit" class="btn btn-primary m-1">New Thread</button>
        </form>
    }

    @if (ViewBag.Threads != null)
    {
        foreach (var thread in ViewBag.Threads)
        {

            <div class="row align-content-center align-bottom">
                <a class="col-auto align-self-center" href="/Thread/Show/@ViewBag.categoryid/@Model.Id/@thread.Id">
                    <div class="category-title">@thread.Name</div>

                </a>
                @if ((thread.AuthorId == User.Identity.GetUserId()) || User.IsInRole("Administrator") || User.IsInRole("Moderator"))
                {
                    <form method="post" action="/Thread/Delete/@thread.Id">

                        @Html.HttpMethodOverride(HttpVerbs.Delete)
                        <button type="submit" class="btn btn-danger m-1">Delete Thread</button>

                    </form>
                }
            </div>
        }
    }
    else
    {
        <div>This subject has no threads.</div>
    }
</div>
